<ng-container *ngIf="vmState$ |async as vm">
  <h1>ToDo List</h1>
  <ng-container *ngIf="!vm.viewState.loadingToDos else loading">
    <div class="actions">
      <div class="filter">
        <span>Filter:</span>
        <input type="radio" name="filter" id="filter-all" [value]="undefined" checked (change)="updateFilterValue('all')"><label for="filter-all">All</label>
        <input type="radio" name="filter" id="filter-open" value="open" (change)="updateFilterValue('open')"><label for="filter-open">Open</label>
        <input type="radio" name="filter" id="filter-closed" value="closed" (change)="updateFilterValue('closed')"><label for="filter-closed">Closed</label>
      </div>
    </div>
    <div infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" [scrollWindow]="false"
      (scrolled)="vm.viewState.listLoadingMode == 'infinite-scrolling' && onScrollDown(vm.pagination)" class="todos-container" [class.disabled]="disableToDosContainer(vm.viewState)">
      <ng-container *ngIf="vm.todos as ToDos">
        <div *ngIf="ToDos.length == 0" class="no-todos">
          No ToDos
        </div>
        <div class="todo" *ngFor="let todo of ToDos; let i = index; trackBy: trackByFn">
          <span class="todo-title">{{displayToDoIndex(i, vm.pagination.page, vm.viewState.listLoadingMode)}}.
            <input type="checkbox" (click)="changeStatus(todo)" [checked]="getStatusForCheckbox(todo.status)"/> {{todo.name | titlecase}} - {{todo.endDate | date}}</span>
          <span class="todo-sub-title">Associated people:</span>
          <div class="person-container" *ngFor="let person of todo.persons; let j = index; trackBy: trackByFn">
            <span class="person-name">- {{person.name}} ({{person.age}})</span>
            <span class="person-skills">
              Skills: <ng-container *ngFor="let skill of person.skills; let k = index; trackBy: trackByFn">
                {{skill}}
              </ng-container>
            </span>
          </div>
        </div>
      </ng-container>
    </div>
    <div *ngIf="vm.viewState.listLoadingMode == 'pagination'" class="pagination">
      <app-paginator [page]="vm.pagination.page" [totalPages]="vm.pagination.pagesCount" (pageChanged)="changePage($event)"></app-paginator>
    </div>
  </ng-container>
</ng-container>

<ng-template #loading>
  <app-loader></app-loader>
</ng-template>
